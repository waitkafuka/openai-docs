import{_ as s,c as n,o as a,V as l}from"./chunks/framework.61392f5d.js";const A=JSON.parse('{"title":"向量化（Embeddings）","description":"","frontmatter":{},"headers":[],"relativePath":"guides/embeddings.md","filePath":"guides/embeddings.md","lastUpdated":null}'),p={name:"guides/embeddings.md"},e=l(`<h1 id="向量化-embeddings" tabindex="-1">向量化（Embeddings） <a class="header-anchor" href="#向量化-embeddings" aria-label="Permalink to &quot;向量化（Embeddings）&quot;">​</a></h1><h2 id="向量化-embeddings-是什么" tabindex="-1">向量化（Embeddings）是什么？ <a class="header-anchor" href="#向量化-embeddings-是什么" aria-label="Permalink to &quot;向量化（Embeddings）是什么？&quot;">​</a></h2><p>OpenAI 的文本用向量化度量文本字符串的相关性。向量化通常用于：</p><ul><li><strong>搜索</strong>（结果按与查询字符串相关性排名）</li><li><strong>聚类</strong>（文本字符串按相似性分组）</li><li><strong>推荐</strong>（推荐具有相关文本字符串的项目）</li><li><strong>异常检测</strong>（识别与相关性较低的异常值）</li><li><strong>多样性测量</strong>（分析相似性分布）</li><li><strong>分类</strong>（将文本字符串按其最相似的标签分类）</li></ul><p>向量化之后是一个可浮动数字列表的向量。两个向量间的距离度量其相关性，小<a href="https://platform.openai.com/docs/guides/embeddings/which-distance-function-should-i-use" target="_blank" rel="noreferrer">距离</a>表明其相关性高，大距离表明其相关性低。</p><p>请访问我们的<a href="https://openai.com/api/pricing/" target="_blank" rel="noreferrer">定价页面</a>了解 Embeddings 定价。价格是基于请求的<a href="https://platform.openai.com/docs/api-reference/embeddings/create#embeddings/create-input" target="_blank" rel="noreferrer">输入</a>中的 token 来计算。</p><div class="info custom-block"><p class="custom-block-title">提示</p><p>要查看向量化的示例，请查看我们的代码示例：</p><ul><li>分类</li><li>主题聚类</li><li>搜索</li><li>推荐</li></ul><p><a tabindex="0" style="color:#fff;" class="btn btn-sm btn-filled btn-primary" href="https://platform.openai.com/docs/guides/embeddings/use-cases"><span class="btn-label-wrap"><span class="btn-label-inner">Browse Samples‍</span></span></a></p></div><h2 id="如何获得-embeddings" tabindex="-1">如何获得 embeddings <a class="header-anchor" href="#如何获得-embeddings" aria-label="Permalink to &quot;如何获得 embeddings&quot;">​</a></h2><p>要获取 embeddings，请将您的文本字符串发送到向量化 API 接口，并选择向量化模型 ID（例如：<code>text-embedding-ada-002</code>）。响应将包含一个 embeddings，您可以提取、保存和使用。</p><p>示例请求：</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-UCdSG" id="tab-Wthr8SX" checked="checked"><label for="tab-Wthr8SX">curl</label><input type="radio" name="group-UCdSG" id="tab-a9R-eDY"><label for="tab-a9R-eDY">python</label></div><div class="blocks"><div class="language-curl active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">curl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">curl https://api.openai.com/v1/embeddings \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H &quot;Content-Type: application/json&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H &quot;Authorization: Bearer $OPENAI_API_KEY&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -d &#39;{</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;input&quot;: &quot;Your text string goes here&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;model&quot;: &quot;text-embedding-ada-002&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> openai</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Your text string goes here</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">embeddings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">embedding</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>示例响应：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;data&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;embedding&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        -0.006929283495992422,</span></span>
<span class="line"><span style="color:#A6ACCD;">        -0.005336422007530928,</span></span>
<span class="line"><span style="color:#A6ACCD;">        ...</span></span>
<span class="line"><span style="color:#A6ACCD;">        -4.547132266452536e-05,</span></span>
<span class="line"><span style="color:#A6ACCD;">        -0.024047505110502243</span></span>
<span class="line"><span style="color:#A6ACCD;">      ],</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;index&quot;: 0,</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;object&quot;: &quot;embedding&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  ],</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;model&quot;: &quot;text-embedding-ada-002&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;object&quot;: &quot;list&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;usage&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;prompt_tokens&quot;: 5,</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;total_tokens&quot;: 5</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>请参阅<a href="https://github.com/openai/openai-cookbook/" target="_blank" rel="noreferrer">OpenAI Cookbook</a>中更多的 Python 代码示例。</p><p>使用 OpenAI Embedding 时，请注意它们的<a href="https://platform.openai.com/docs/guides/embeddings/limitations-risks" target="_blank" rel="noreferrer">限制和风险</a>。</p><h2 id="embedding-模型" tabindex="-1">embedding 模型 <a class="header-anchor" href="#embedding-模型" aria-label="Permalink to &quot;embedding 模型&quot;">​</a></h2><p>OpenAI 提供了一个第二代 Embedding 模型（在模型 ID 中用<code>-002</code> 表示）和 16 个第一代模型（在模型 ID 中用<code>-001</code> 表示）。</p><p>我们推荐几乎所有用例都使用 <code>text-embedding-ada-002</code>。它更好、更便宜、更简单。请阅读<a href="https://openai.com/blog/new-and-improved-embedding-model" target="_blank" rel="noreferrer">博客公告</a>。</p><table><thead><tr><th>模型生成</th><th>分词器</th><th>最大输入标记</th><th>知识截止日期</th></tr></thead><tbody><tr><td>V2</td><td>cl100k_base</td><td>8191</td><td>2021 年 9 月</td></tr><tr><td>V1</td><td>GPT-2/GPT-3</td><td>2046</td><td>2020 年 8 月</td></tr></tbody></table><p>请参阅 OpenAI Cookbook 中更多的 Python 代码示例。</p><p>使用价格每输入 token 计价，每 1000 个 token 收费 0.0004 美元，大约是 3000 页书 1 美元（假设每页约有 800 个标记）：</p><table><thead><tr><th>模型</th><th>每美元的粗略页面</th><th>BEIR 搜索评估的例子性能</th></tr></thead><tbody><tr><td>text-embedding-ada-002</td><td>3000</td><td>53.9</td></tr><tr><td>*-davinci-*-001</td><td>6</td><td>52.8</td></tr><tr><td>*-curie-*-001</td><td>60</td><td>50.9</td></tr><tr><td>*-babbage-*-001</td><td>240</td><td>50.4</td></tr><tr><td>*-ada-*-001</td><td>300</td><td>49.0</td></tr></tbody></table><h3 id="第二代模型" tabindex="-1">第二代模型 <a class="header-anchor" href="#第二代模型" aria-label="Permalink to &quot;第二代模型&quot;">​</a></h3><table><thead><tr><th>模型名称</th><th>分词器</th><th>最大输入标记</th><th>输出维度</th></tr></thead><tbody><tr><td>text-embedding-ada-002</td><td>cl100k_base</td><td>8191</td><td>1536</td></tr></tbody></table><details class="details custom-block"><summary>第一代模型（不推荐）</summary><p><a href="https://platform.openai.com/docs/guides/embeddings/what-are-embeddings?lang=python" target="_blank" rel="noreferrer">查看</a></p></details><h2 id="应用场景" tabindex="-1">应用场景 <a class="header-anchor" href="#应用场景" aria-label="Permalink to &quot;应用场景&quot;">​</a></h2><p>这里我们展示一些代表性的应用场景。我们将使用亚马逊<a href="https://www.kaggle.com/snap/amazon-fine-food-reviews" target="_blank" rel="noreferrer">精细食品评论</a>数据集进行以下示例。</p><h3 id="获取-embedding" tabindex="-1">获取 Embedding <a class="header-anchor" href="#获取-embedding" aria-label="Permalink to &quot;获取 Embedding&quot;">​</a></h3><p>该数据集包含截至 2012 年 10 月由亚马逊用户留下的共计 568,454 个食品评论。我们将使用最近的 1,000 条评论的子集进行演示。评论是用英语编写的，往往是积极或消极的。每条评论都有一个 ProductId、UserId、Score、评论标题（Summary）和评论正文（Text）。例如：</p><table><thead><tr><th>产品 ID</th><th>用户 ID</th><th>得分</th><th>摘要</th><th>正文</th></tr></thead><tbody><tr><td>B001E4KFG0</td><td>A3SGXH7AUHU8GW</td><td>5</td><td>好品质狗粮。</td><td>我已经买了几罐活力狗粮……</td></tr><tr><td>B00813GRG4</td><td>A1D87F6ZCVE5NK</td><td>1</td><td>不如广告。</td><td>产品标签写着巨型盐渍花生……</td></tr></tbody></table><p>我们将评论概要和评论文本组合成单个组合文本。模型将对这个组合文本进行编码，输出单个向量 embedding。</p><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Obtain_dataset.ipynb" target="_blank" rel="noreferrer">获取数据集</a></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">text</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">   text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> openai</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">)[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">embedding</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ada_embedding</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">combined</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">to_csv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output/embedded_1k_reviews.csv</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=False)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果想要从已保存的文件中加载数据，你可以这样：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pandas </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">df </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> pd</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_csv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output/embedded_1k_reviews.csv</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ada_embedding</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">eval</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">array</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details class="details custom-block"><summary>数据 2D 可视化</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Visualizing_embeddings_in_2D.ipynb" target="_blank" rel="noreferrer" class="tag-link">Visualizing_embeddings_in_2D.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> Embedding 的大小取决于底层模型的复杂性。为了可视化这个高维数据，我们使用 t-SNE 算法将数据转换为二维。我们根据评价者给出的星级评价将各个评论着色：</p><p>1 星：红色<br> 2 星：深橙色<br> 3 星：金色<br> 4 星：青绿色<br> 5 星：深绿色</p><p><picture><source type="image/webp" srcset="https://cdn.openai.com/API/docs/images/embeddings-tsne.webp"><source type="image/png" srcset="https://cdn.openai.com/API/docs/images/embeddings-tsne.png"><img src="https://cdn.openai.com/API/docs/images/embeddings-tsne.png" alt="Amazon ratings visualized in language using t-SNE" width="414" height="290"></picture></p><p>可视化似乎产生了大约 3 个聚类簇，其中一个聚类簇主要由消极评价组成。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pandas </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> pd</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">manifold </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> TSNE</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> matplotlib</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pyplot</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> plt</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> matplotlib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">df </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> pd</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_csv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output/embedded_1k_reviews.csv</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">matrix </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">eval</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">to_list</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Create a t-SNE model and transform the data</span></span>
<span class="line"><span style="color:#A6ACCD;">tsne </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TSNE</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">n_components</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">perplexity</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">random_state</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">42</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">init</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">random</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">learning_rate</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">vis_dims </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tsne</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fit_transform</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">matrix</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">colors </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">red</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">darkorange</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gold</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">turquiose</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">darkgreen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">x </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">y </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> vis_dims</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">y </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">y </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> vis_dims</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">color_indices </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Score</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">values</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">colormap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> matplotlib</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">colors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ListedColormap</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">colors</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">scatter</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> y</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">c</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">color_indices</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">cmap</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">colormap</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">alpha</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0.3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">title</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Amazon ratings visualized in language using t-SNE</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></details><details class="details custom-block"><summary>Embedding 作为 ML 算法的文本特征编码器</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Regression_using_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">Regression_using_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a></p><p>如果某些相关输入是自然文本，则引入 embedding 将提高任何机器学习模型的性能。embedding 还可以作为机器学习模型中的分类特征编码器。如果分类变量的名称具有意义且数量众多，例如职位名称，则价值最大。对于此任务，相似性 embedding 通常比搜索 embedding 表现更好。</p><p>我们观察到 embedding 表示通常非常丰富和信息密集。例如，使用 SVD 或 PCA 将输入的维数降低仅 10％，通常会导致特定任务的下游性能更差。</p><p>此代码将数据分成训练集和测试集，将分别用于下面的两个用例，即回归和分类。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">model_selection </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> train_test_split</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">X_train</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> X_test</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y_train</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y_test </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">train_test_split</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#FFCB6B;">list</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Score</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">test_size</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">random_state</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">42</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="使用-embedding-特征的回归" tabindex="-1">使用 Embedding 特征的回归 <a class="header-anchor" href="#使用-embedding-特征的回归" aria-label="Permalink to &quot;使用 Embedding 特征的回归&quot;">​</a></h4><p>Embedding 提供了一种优雅的预测数值值的方式。在此示例中，我们根据评论文本预测评论者的星级评分。由于 Embedding 中包含的语义信息很高，即使只有很少的评论，预测也是不错的。</p><p>我们假设分数是 1 到 5 之间的连续变量，并允许算法预测任何浮点值。机器学习算法将预测值与真实分数的距离最小化，并取得了均方误差为 0.39 的效果，这意味着平均预测偏差不到半星。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ensemble </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RandomForestRegressor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">rfr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RandomForestRegressor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">n_estimators</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">rfr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fit</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">X_train，y_train</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">preds </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rfr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">predict</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">X_test</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></details><details class="details custom-block"><summary>利用 embedding 特性进行文本分类</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Classification_using_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">Classification_using_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a></p><p>这次，我们将尝试将算法分类为 5 个桶，从 1 星到 5 星，而不是预测 1 到 5 之间的任何值来预测评论中的确切星级数量。</p><p>在训练后，该模型学会了更好地预测 1 星和 5 星的评论，而不是更细微差别（2-4 星）的评论，可能由于更极端的情感表达造成。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ensemble </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RandomForestClassifier</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">metrics </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> classification_report</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> accuracy_score</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">clf </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RandomForestClassifier</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">n_estimators</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">clf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fit</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">X_train</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> y_train</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">preds </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> clf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">predict</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">X_test</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details><details class="details custom-block"><summary>zero-shot 分类</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Zero-shot_classification_with_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">Zero-shot_classification_with_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> 我们可以使用 embedding 进行零样本分类，无需任何标注训练数据。对于每个类别，我们将类名或类别简短描述进行嵌入。在零样本分类中，我们将待分类的新文本与所有类别的嵌入进行比较，预测相似度最高的类别。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> openai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">embeddings_utils </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> cosine_similarity</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> get_embedding</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Score</span><span style="color:#89DDFF;">!=</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sentiment</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Score</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">({</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">negative</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">negative</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">positive</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">positive</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">labels </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">negative</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">positive</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">label_embeddings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">label</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> label </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> labels</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">label_score</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">review_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">label_embeddings</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cosine_similarity</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">review_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> label_embeddings</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cosine_similarity</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">review_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> label_embeddings</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">prediction </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">positive</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">label_score</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Sample Review</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> label_embeddings</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">negative</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></details><details class="details custom-block"><summary>为冷启动建议获得用户和产品 embedding</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/User_and_product_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">User_and_product_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> 我们可以通过对用户所有评论求平均值来获得用户嵌入。类似地，我们可以通过对围绕该产品的所有评论进行平均值来获得产品嵌入。为展示这种方法的有用性，我们使用了一个包含 50k 条评论的子集，以涵盖更多用户和产品的评论。</p><p>我们在一个单独的测试集上评估这些嵌入的有用性，我们以评分作为函数来绘制用户和产品嵌入的相似性。有趣的是，在这种方法的基础上，即使在用户收到产品之前，我们也可以比随机更好地预测他们是否会喜欢该产品。 <picture><source type="image/webp" srcset="https://cdn.openai.com/API/docs/images/embeddings-boxplot.webp"><source type="image/png" srcset="https://cdn.openai.com/API/docs/images/embeddings-boxplot.png"><img src="https://cdn.openai.com/API/docs/images/embeddings-boxplot.png" alt="Boxplot grouped by Score" width="420" height="312"></picture></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">user_embeddings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">groupby</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">UserId</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mean</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">prod_embeddings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">groupby</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ProductId</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mean</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><details class="details custom-block"><summary>聚类</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Clustering.ipynb" target="_blank" rel="noreferrer" class="tag-link">Clustering.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> 聚类是理解大量文本数据的一种方法。嵌入对于此任务非常有用，因为它们提供了每个文本的语义有意义的向量表示。因此，在无监督的方式中，聚类将揭示数据集中隐藏的分组。</p><p>在这个例子中，我们发现了四个明显的聚类：一个聚焦于狗粮，一个聚焦于负面评论，以及两个聚焦于正面评论。</p><p><picture><source type="image/webp" srcset="https://cdn.openai.com/API/docs/images/embeddings-cluster.webp"><source type="image/png" srcset="https://cdn.openai.com/API/docs/images/embeddings-cluster.png"><img src="https://cdn.openai.com/API/docs/images/embeddings-cluster.png" alt="Clusters identified visualized in language 2d using t-SNE" width="418" height="290"></picture></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cluster </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> KMeans</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">matrix </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">vstack</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">n_clusters </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">kmeans </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">KMeans</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">n_clusters</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> n_clusters</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">init</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">k-means++</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">random_state</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">42</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">kmeans</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fit</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">matrix</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Cluster</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> kmeans</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">labels_</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details><details class="details custom-block"><summary>用 embeddings 进行文本搜索</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Semantic_text_search_using_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">Semantic_text_search_using_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a></p><p>为了检索最相关的文档，我们使用查询嵌入向量和每个文档之间的余弦相似度，并返回得分最高的文档。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> openai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">embeddings_utils </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> get_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> cosine_similarity</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search_reviews</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">df</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">product_description</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">pprint</span><span style="color:#89DDFF;">=True):</span></span>
<span class="line"><span style="color:#A6ACCD;"> embedding </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">product_description</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">similarities</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ada_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> cosine_similarity</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> embedding</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;"> res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort_values</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">similarities</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">ascending</span><span style="color:#89DDFF;">=False).</span><span style="color:#82AAFF;">head</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">n</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search_reviews</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">df</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">delicious beans</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details><details class="details custom-block"><summary>用 embeddings 代码搜索</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Code_search.ipynb" target="_blank" rel="noreferrer" class="tag-link">Code_search.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> 使用嵌入进行代码与基于嵌入的文本搜索类似。我们提供了一种方法，从给定资料库中的所有 Python 文件中提取 Python 函数。然后，每个函数都由文本嵌入 ada-002 模型索引。</p><p>为了进行代码搜索，我们使用相同的模型将查询以自然语言嵌入式编码。然后，我们计算结果查询嵌入和每个函数嵌入之间的余弦相似性。最高的余弦相似度结果最相关。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> openai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">embeddings_utils </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> get_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> cosine_similarity</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">code_embedding</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">code</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search_functions</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">df</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">code_query</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">pprint</span><span style="color:#89DDFF;">=True,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">n_lines</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">   embedding </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_embedding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">code_query</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   df</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">similarities</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">code_embedding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> cosine_similarity</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> embedding</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> df</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort_values</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">similarities</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">ascending</span><span style="color:#89DDFF;">=False).</span><span style="color:#82AAFF;">head</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">n</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> res</span></span>
<span class="line"><span style="color:#A6ACCD;">res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">search_functions</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">df</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Completions API tests</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details><details class="details custom-block"><summary>用 embeddings 进行推荐</summary><p><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Recommendation_using_embeddings.ipynb" target="_blank" rel="noreferrer" class="tag-link">Recommendation_using_embeddings.ipynb<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="tag-link-icon" width="1em" height="1em"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.5859 5H11V3H17V9H15V6.4143L8.70718 12.7071L7.29297 11.2929L13.5859 5ZM9 5H5H3V7V15V17H5H13H15V15V11H13V15H5V7H9V5Z"></path></svg></a><br> 因为嵌入向量之间的距离越短，表示它们越相似，所以嵌入可以用于推荐系统。下面，我们展示一个基本的推荐系统。它输入一个字符串列表和一个“源”字符串，计算它们的嵌入，然后返回一个字符串排名，按照与源字符串最相似到最不相似的顺序进行排列。<br> 作为一个具体的例子，下面的链接笔记本将此功能的一个版本应用于 <a href="http://groups.di.unipi.it/~gulli/AG_corpus_of_news_articles.html" target="_blank" rel="noreferrer">AG 新闻数据集</a>（缩减到 2000 个新闻文章描述），以返回与任何给定源文章最相似的前 5 篇文章。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">recommendations_from_strings</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;font-style:italic;">strings</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> List</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;font-style:italic;">index_of_source_string</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-embedding-ada-002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> List</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">]:</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">Return nearest neighbors of a given string.</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># get embeddings for all strings</span></span>
<span class="line"><span style="color:#A6ACCD;">   embeddings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">embedding_from_string</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">string</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> string </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> strings</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># get the embedding of the source string</span></span>
<span class="line"><span style="color:#A6ACCD;">   query_embedding </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> embeddings</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">index_of_source_string</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># get distances between the source embedding and other embeddings (function from embeddings_utils.py)</span></span>
<span class="line"><span style="color:#A6ACCD;">   distances </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">distances_from_embeddings</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_embedding</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> embeddings</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">distance_metric</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cosine</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># get indices of nearest neighbors (function from embeddings_utils.py)</span></span>
<span class="line"><span style="color:#A6ACCD;">   indices_of_nearest_neighbors </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">indices_of_nearest_neighbors_from_distances</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">distances</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> indices_of_nearest_neighbors</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></details><h2 id="限制和风险" tabindex="-1">限制和风险 <a class="header-anchor" href="#限制和风险" aria-label="Permalink to &quot;限制和风险&quot;">​</a></h2><p>我们的 embedding 模型在某些情况下可能不可靠或存在社会风险，并且在没有补救措施的情况下可能会造成伤害。</p><h3 id="社会偏见" tabindex="-1">社会偏见 <a class="header-anchor" href="#社会偏见" aria-label="Permalink to &quot;社会偏见&quot;">​</a></h3><div class="info custom-block"><p class="custom-block-title">限制</p><p>The models encode social biases, e.g. via stereotypes or negative sentiment towards certain groups. 模型可能编码社会偏见，例如通过刻板印象或对某些群体的负面情绪。</p></div><p>我们通过运行 SEAT（<a href="https://arxiv.org/abs/1903.10561" target="_blank" rel="noreferrer">May et al，2019</a>）和 Winogender（<a href="https://arxiv.org/abs/1804.09301" target="_blank" rel="noreferrer">Rudinger et al，2018</a>）基准测试发现我们的模型存在偏见。这些基准测试包括 7 个测试，测试模型在应用于性别名称、地区名称和某些刻板印象时是否包含隐含偏见。</p><p>例如，我们发现我们的模型更强烈地将（a）欧裔美国人的姓名与积极情绪相关联，而相较于非裔美国人的姓名，（b）将负面刻板印象与黑人女性相关联。</p><p>这些基准测试在几个方面都有限制：（a）它们可能不适用于您的特定用例，以及（b）它们仅针对可能存在的极小一部分社会偏见进行测试。</p><p>这些测试是初步的，我们建议为您的特定用例运行测试。这些结果应被视为存在该现象的证据，而不是对您的用例的明确描述。有关更多详细信息和指导，请参见我们的<a href="https://openai.com/policies/usage-policies" target="_blank" rel="noreferrer">使用政策</a>。</p><p>如果您有任何问题，请<a href="https://help.openai.com/en/" target="_blank" rel="noreferrer">通过聊天联系我们的支持团队</a>；我们很乐意为您提供建议。</p><p>对最近事件的缺失</p><div class="info custom-block"><p class="custom-block-title">限制</p><p>模型缺乏对 2020 年 8 月之后发生的事件的了解。</p></div><p>我们的模型是基于数据集训练的，这些数据集包含有关实际世界事件的某些信息，直到 8/2020。如果您依赖于模型代表最近事件，那么它们可能表现不佳。</p><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="我如何在-embedding-字符串之前查看它有多少个令牌" tabindex="-1">我如何在 embedding 字符串之前查看它有多少个令牌？ <a class="header-anchor" href="#我如何在-embedding-字符串之前查看它有多少个令牌" aria-label="Permalink to &quot;我如何在 embedding 字符串之前查看它有多少个令牌？&quot;">​</a></h3><p>在 Python 中，您可以使用 OpenAI 的分词器 tiktoken 将字符串拆分为令牌。</p><p>示例代码：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> tiktoken</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">num_tokens_from_string</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">string</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">encoding_name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">返回文本字符串中令牌的数量。</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">encoding </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tiktoken</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_encoding</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">encoding_name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">num_tokens </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">encoding</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">string</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> num_tokens</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">num_tokens_from_string</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tiktoken is great!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cl100k_base</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>对于像 <code>text-embedding-ada-002</code> 这样的第二代嵌入模型，请使用 <code>cl100k_base</code> 编码。</p><p>有关更多详细信息和示例代码，请参见 OpenAI Cookbook 指南<a href="https://github.com/openai/openai-cookbook/blob/main/examples/How_to_count_tokens_with_tiktoken.ipynb" target="_blank" rel="noreferrer">如何使用 tiktoken 计数令牌</a>。</p><h3 id="我如何快速检索-k-个最近的嵌入向量" tabindex="-1">我如何快速检索 K 个最近的嵌入向量？ <a class="header-anchor" href="#我如何快速检索-k-个最近的嵌入向量" aria-label="Permalink to &quot;我如何快速检索 K 个最近的嵌入向量？&quot;">​</a></h3><p>为了快速搜索多个向量，我们推荐使用向量数据库。在我们的 GitHub 上的 <a href="https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases" target="_blank" rel="noreferrer">Cookbook</a> 中，您可以找到使用向量数据库和 OpenAI API 的工作示例。</p><p>向量数据库选项包括：</p><ul><li>Pinecone，一个完全管理的向量数据库</li><li>Weaviate，一个开源的向量搜索引擎</li><li>Redis 作为向量数据库</li><li>Qdrant，一个向量搜索引擎</li><li>Milvus，用于可扩展相似度搜索的向量数据库</li><li>Chroma，一个开源的嵌入存储</li><li>Typesense，快速的开源向量搜索</li><li>Zilliz，由 Milvus 提供技术支持的数据基础设施</li></ul><h3 id="我应该使用哪个距离函数" tabindex="-1">我应该使用哪个距离函数？ <a class="header-anchor" href="#我应该使用哪个距离函数" aria-label="Permalink to &quot;我应该使用哪个距离函数？&quot;">​</a></h3><p>我们建议使用<a href="https://en.wikipedia.org/wiki/Cosine_similarity" target="_blank" rel="noreferrer">余弦相似度</a>。距离函数的选择通常并不重要。</p><p>OpenAI embeddings 被统一为长度 1，这意味着：</p><ul><li>可以使用点积更快地计算余弦相似度</li><li>余弦相似度和欧几里得距离将产生相同的排名</li></ul><h3 id="我可以在线共享我的嵌入向量吗" tabindex="-1">我可以在线共享我的嵌入向量吗？ <a class="header-anchor" href="#我可以在线共享我的嵌入向量吗" aria-label="Permalink to &quot;我可以在线共享我的嵌入向量吗？&quot;">​</a></h3><p>客户拥有我们的模型的输入和输出，包括 embeddings。您有责任确保您输入到我们的 API 中的内容不违反任何适用法律或我们的<a href="https://openai.com/policies/terms-of-use" target="_blank" rel="noreferrer">使用条款</a>。</p>`,73),o=[e];function t(r,c,i,F,D,y){return a(),n("div",null,o)}const C=s(p,[["render",t]]);export{A as __pageData,C as default};
